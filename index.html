<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN BOSS | ADMIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --main: #ff6b00; --bg: #000; }
        body { background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
        
        /* КАРТКИ ЗВЕРХУ */
        #partnersGrid { 
            flex: 1; display: flex; flex-direction: column-reverse; 
            align-items: center; padding: 20px; gap: 15px; overflow-y: auto; 
        }

        .card { 
            width: 90%; max-width: 400px; background: var(--main); color: #000; 
            padding: 20px; border-radius: 15px; position: relative;
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.5); font-weight: 900;
        }

        .card-code { font-size: 1.8rem; text-transform: uppercase; }
        .stat { background: rgba(0,0,0,0.1); padding: 10px; border-radius: 8px; margin: 10px 0; }
        .money { font-size: 1.5rem; border-top: 2px solid #000; padding-top: 10px; display: block; }
        .del { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; }

        /* ПАНЕЛЬ ВВОДУ ЗНИЗУ */
        .bottom-panel { background: #111; padding: 20px; border-top: 3px solid var(--main); position: sticky; bottom: 0; }
        .input-group { display: flex; gap: 10px; max-width: 500px; margin: 0 auto; }
        input { background: #000; border: 2px solid var(--main); color: #fff; padding: 12px; border-radius: 8px; flex: 1; font-family: 'Orbitron'; outline: none; }
        button#addBtn { background: var(--main); border: none; padding: 12px 20px; border-radius: 8px; font-weight: 900; cursor: pointer; color: #000; }
    </style>
</head>
<body>

<div id="partnersGrid"></div>

<div class="bottom-panel">
    <div class="input-group">
        <input type="text" id="newCode" placeholder="ВВЕДІТЬ КОД">
        <button id="addBtn">ДОДАТИ</button>
    </div>
</div>

<script type="module">
    // Імпорт нових модулів Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Твої ключі зі скріншота
    const firebaseConfig = {
        apiKey: "AIzaSyDcsXkmVb9lw5C4ZCLf1PMoLqb5ZO2nA3Y",
        authDomain: "vip-shop-a2ec4.firebaseapp.com",
        databaseURL: "https://vip-shop-a2ec4-default-rtdb.firebaseio.com",
        projectId: "vip-shop-a2ec4",
        storageBucket: "vip-shop-a2ec4.firebasestorage.app",
        messagingSenderId: "429877342673",
        appId: "1:429877342673:web:0d2b5443f46bc03ec670f0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Функція додавання
    document.getElementById('addBtn').onclick = () => {
        const code = document.getElementById('newCode').value.toUpperCase().trim();
        if(code) {
            set(ref(db, 'affiliates/' + code), { count: 0 })
                .then(() => { document.getElementById('newCode').value = ''; })
                .catch(e => alert("Помилка: " + e.message));
        }
    };

    // Візуалізація
    onValue(ref(db, 'affiliates'), (snapshot) => {
        const grid = document.getElementById('partnersGrid');
        const data = snapshot.val();
        grid.innerHTML = '';

        if(!data) return;

        for (let key in data) {
            const count = data[key].count || 0;
            const money = (count * 0.20).toFixed(2);

            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="del">✕</div>
                <div style="font-size:0.7rem; opacity:0.7;">AUTHOR:</div>
                <div class="card-code">${key}</div>
                <div class="stat">АКТИВАЦІЙ: ${count}</div>
                <b class="money">${money} €</b>
                <button class="reset-btn" style="width:100%; margin-top:10px; background:#000; color:#fff; border:none; padding:8px; border-radius:5px; font-family:'Orbitron'; cursor:pointer;">ОБНУЛИТИ</button>
            `;

            // Обробка видалення та обнулення
            card.querySelector('.del').onclick = () => { if(confirm("Видалити?")) remove(ref(db, 'affiliates/' + key)); };
            card.querySelector('.reset-btn').onclick = () => { if(confirm("Обнулити?")) update(ref(db, 'affiliates/' + key), { count: 0 }); };

            grid.appendChild(card);
        }
    });
</script>

</body>
</html>
