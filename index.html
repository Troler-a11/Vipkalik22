<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN BOSS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #fff; font-family: 'Orbitron', sans-serif; margin: 0; padding-bottom: 100px; }
        #partnersGrid { display: flex; flex-direction: column-reverse; align-items: center; padding: 20px; gap: 15px; }
        
        /* Помаранчева картка */
        .card { 
            width: 90%; max-width: 350px; background: #ff6b00; color: #000; 
            padding: 20px; border-radius: 15px; position: relative; font-weight: 900;
        }
        .card-code { font-size: 1.5rem; text-transform: uppercase; margin-bottom: 5px; }
        .money { font-size: 1.8rem; display: block; margin-top: 10px; border-top: 2px solid #000; }
        .del { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; }

        /* Панель знизу */
        .bottom { position: fixed; bottom: 0; width: 100%; background: #111; padding: 20px; border-top: 3px solid #ff6b00; box-sizing: border-box; display: flex; gap: 10px; }
        input { flex: 1; background: #000; border: 2px solid #ff6b00; color: #fff; padding: 12px; border-radius: 8px; font-family: 'Orbitron'; }
        button#addBtn { background: #ff6b00; border: none; padding: 12px; border-radius: 8px; font-weight: 900; cursor: pointer; }
    </style>
</head>
<body>

<div id="partnersGrid"></div>

<div class="bottom">
    <input type="text" id="newCode" placeholder="КОД">
    <button id="addBtn">ДОДАТИ</button>
</div>

<script type="module">
    // Використовуємо версію, яка точно працює всюди
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDcsXkmVb9lw5C4ZCLf1PMoLqb5ZO2nA3Y",
        authDomain: "vip-shop-a2ec4.firebaseapp.com",
        databaseURL: "https://vip-shop-a2ec4-default-rtdb.firebaseio.com",
        projectId: "vip-shop-a2ec4",
        storageBucket: "vip-shop-a2ec4.firebasestorage.app",
        messagingSenderId: "429877342673",
        appId: "1:429877342673:web:0d2b5443f46bc03ec670f0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Кнопка ДОДАТИ
    document.getElementById('addBtn').addEventListener('click', () => {
        const code = document.getElementById('newCode').value.toUpperCase().trim();
        if(code) {
            set(ref(db, 'affiliates/' + code), { count: 0 })
                .then(() => { document.getElementById('newCode').value = ''; })
                .catch(e => alert("Помилка запису: " + e.message));
        }
    });

    // Малювання карток
    onValue(ref(db, 'affiliates'), (snap) => {
        const grid = document.getElementById('partnersGrid');
        grid.innerHTML = '';
        const data = snap.val();
        if(!data) return;

        for (let key in data) {
            const count = data[key].count || 0;
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="del">✕</div>
                <div style="font-size:0.7rem;">ПАРТНЕР:</div>
                <div class="card-code">${key}</div>
                <div style="margin-top:5px;">ЮЗЕРІВ: ${count}</div>
                <b class="money">${(count * 0.2).toFixed(2)} €</b>
                <button class="res" style="width:100%; margin-top:10px; background:#000; color:#fff; border:none; padding:8px; border-radius:5px; font-family:'Orbitron'; cursor:pointer;">ОБНУЛИТИ</button>
            `;

            card.querySelector('.del').onclick = () => remove(ref(db, 'affiliates/' + key));
            card.querySelector('.res').onclick = () => update(ref(db, 'affiliates/' + key), { count: 0 });
            
            grid.appendChild(card);
        }
    });
</script>

</body>
</html>
